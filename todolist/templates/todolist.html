{% extends 'base.html' %}

{% block meta %}
    <style>

    .containerA {
        width: 500px;
        padding:  0 0;
        margin: auto;
    }

    .formA {
        position: relative;
        background-color: #5bb1ab;
        max-width: 800px;
        border-radius: 18px;
        text-align: center;
        box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.2), 0 5px 5px 0 rgba(0, 0, 0, 0.24);
    }

    #form {
        display: none;
    }

    #btnA {
        width: 120px;
        margin-top: auto;
        margin-bottom: auto;
        margin-left: auto;
        margin-right: auto;
        background-color: #d28542;
        padding: 5px 15px;
        border-radius: 15px;
        color: white;
        font: bold;
        font-size: 15px;
    }

    #btnA:hover {
        box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);
    }

    </style>

    <title> Home </title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
    
        function load(data) {
            let card = ``;
    
            for (let i of data) {

                let is_finished_status = i.fields.is_finished ? "Finished" : "Haven't Finish"

                card += `
                    <div id="${i.pk}" class="card shadow p-3 mb-5 bg-body rounded mx-3 my-4 mouse">
                        <div class="card" style="width: 19rem; height: 100%;">
                            <div class="card-body">
                                <div>
                                    <button id ="btn-ans"><a href="/todolist/update_status/${i.pk}">${is_finished_status}</a></button>
                                    <button id ="btn-ans" onclick= "delete_task(${i.pk})">Delete</button>
                                </div>
                                <br>
                                <small class="card-subtitle mb-2 text-muted">${i.fields.date}</small>
                                <h5 class="card-title">${i.fields.title}</h5>
                                <p class="card-text tex-truncate">${i.fields.description}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
    
            document.getElementById("make-card").innerHTML = card;
        }

        function refresh() {
            $.get("{% url 'todolist:json' %}", function (data) {
                load(data);
                console.log(data);
            });
        }
     
        $(document).ready(function () {
            refresh();
        });

        function addTask() {
            var j = document.getElementById("form");
            if (j.style.display === "none") {
                j.style.display = "block";
            } else {
                j.style.display = "none";
            }
        }

        function hideForm() {
            var j = document.getElementById("form");
            j.style.display = "none";
        }

        $(document).on("submit", "#form", function (e) {
            e.preventDefault();
            $.ajax({
                type: "POST",
                url: "{% url 'todolist:add-task' %}",
                data: {
                    csrfmiddlewaretoken: "{{ csrf_token }}",
                    title: $("#title").val(),
                    description: $("#description").val(),
                },
                dataType: "json",
                success: function () {
                    refresh();
                    document.getElementById("title").value = "";
                    document.getElementById("description").value = "";
                    hideForm();
                },
            });
        });
        
        function delete_task(id){
            $.ajax({
                type: "GET",
                url: "/todolist/delete-task/" + id,
                data: {csrfmiddlewaretoken: "{{ csrf_token }}"},
                dataType: "json",
                success: function () {
                    refresh();
                }
            })
        }
    
    </script>

{% endblock meta %}

{% block content %}

    <nav class="navbar">
        <div class="container-fluid">
          <span class="navbar-brand mb-0 h1">Welcome {{username}}! </span>
          <div class="d-flex" >
            <button class="btn btn-outline-success me-2" type="button"><a href="{% url 'todolist:logout' %}">Logout</a></button>
          </div>
        </div>
    </nav>

    <br>
    <h2>To Do List Generator</h2>
    <p class = "p">Tugas 4 Assignment PBP/PBD</p>

    <br>

    <div class = "button">
        <button onclick= "addTask()" class = btn-create> Add Task </button>
    </div>

    <br>

    {% if messages %}  
    <ul class = "messageT">   
        {% for message in messages %}  
            <li>{{ message }}</li>  
            {% endfor %}  
    </ul>   
    {% endif %}

    <div class = "containerA">
        <div class = "formA">
            <form id="form">
                {% csrf_token %}
                <div>
                    <br>
                    <label>Title</label>
                    <br>
                    <input id="title" type="text" name="nama_barang"></input>
                </div>
                <div>
                    <label>Description</label>
                    <br>
                    <textarea id="description" name="description" id="" cols="40" rows="10"></textarea>         
                </div>
                <button id="btnA" type="submit" value="Submit">Submit</button>
                <br></br>
            </form>
        </div>
    </div>
    

    <div class="d-flex flex-wrap justify-content-center" id="make-card"></div>

{% endblock content%}
